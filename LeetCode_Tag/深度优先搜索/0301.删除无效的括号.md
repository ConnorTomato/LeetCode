```java
class Solution {
    // 结果去重
    private Set<String> set = new HashSet<>();
    // 最多允许的左括号数量（= 可匹配的最大对数）
    private int maxPairs = 0;
    // 当前找到的最长合法字符串长度
    private int maxLen = 0;
    public List<String> removeInvalidParentheses(String s) {
        int l = 0, r = 0;
        for (char c : s.toCharArray()) {
            if (c == '(') {
                l++;
            } else if (c == ')') {
                r++;
            }
        }
        this.maxPairs = Math.min(l, r);
        dfs(s, 0, new StringBuilder(), 0);
        return new ArrayList<>(set);
    }

    private void dfs(String s, int index, StringBuilder path, int score) {
        // 剪枝：非法括号状态
        if (score < 0 || score > maxPairs) {
            return;
        }
        // 合法结果
        if (index == s.length()) {
            if (score == 0) {
                if (path.length() > maxLen) {
                    set.clear();
                    maxLen = path.length();
                    set.add(path.toString());
                } else if (path.length() == maxLen) {
                    set.add(path.toString());
                }
            }
            return;
        }
        if (s.charAt(index) == '(') {
            // 选择 1：保留 '('
            path.append("(");
            dfs(s, index + 1, path, score + 1);
            path.deleteCharAt(path.length() - 1);
            // 选择 2：删除 '('
            dfs(s, index + 1, path, score);
        } else if (s.charAt(index) == ')') {
            path.append(")");
            dfs(s, index + 1, path, score - 1);
            path.deleteCharAt(path.length() - 1);
            dfs(s, index + 1, path, score);
        } else {
             // 普通字符必须保留
            path.append(s.charAt(index));
            dfs(s, index + 1, path, score);
            path.deleteCharAt(path.length() - 1);
        }
    }
}
```
